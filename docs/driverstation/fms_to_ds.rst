FMS to Driver Station
=====================

UDP
---

Sent to the DS on UDP port 1121 by the FMS every 500ms. (Was 1120, changed at some point?)

.. table::
   :widths: auto

   +------------------+--------+-----------------------------+----------------------------------------------------------+
   | Field            | Length | Type                        | Comment                                                  |
   +==================+========+=============================+==========================================================+
   | Sequence Num     | 2      | uint16                      |                                                          |
   +------------------+--------+-----------------------------+----------------------------------------------------------+
   | Comm Version     | 1      | uint8                       | Only `0x00` has been observed                            |
   +------------------+--------+-----------------------------+----------------------------------------------------------+
   | Control Byte     | 1      | :ref:`Control <fd control>` | Contains control bits                                    |
   +------------------+--------+-----------------------------+----------------------------------------------------------+
   | Request Byte     | 1      | Request                     | Stays at `0x00`, not used                                |
   +------------------+--------+-----------------------------+----------------------------------------------------------+
   | Alliance Station | 1      | `Alliance Station`_         | Represents the station the DS connects to                |
   +------------------+--------+-----------------------------+----------------------------------------------------------+
   | Tournament Level | 1      | `Tournament Level`_         | What level of competition this is                        |
   +------------------+--------+-----------------------------+----------------------------------------------------------+
   | Match Number     | 2      | uint16                      | Represents the number of current match                   |
   +------------------+--------+-----------------------------+----------------------------------------------------------+
   | Play Number      | 1      | uint8                       | Increments if there's a replay                           |
   +------------------+--------+-----------------------------+----------------------------------------------------------+
   | Date             | 10     | :ref:`Date <fd date>`       |                                                          |
   +------------------+--------+-----------------------------+----------------------------------------------------------+
   | Remaining Time   | 2      | uint16                      | Time left in current mode                                |
   +------------------+--------+-----------------------------+----------------------------------------------------------+
   | Tags             | n      | Tags                        | Offseason FMS has code for sending tags but none to send |
   +------------------+--------+-----------------------------+----------------------------------------------------------+

.. _`fd control`:

Control
^^^^^^^

.. table::
   :widths: auto

   +---------+--------------+-----------------------------------+
   | Field   | Mask         | Comment                           |
   +---------+--------------+-----------------------------------+
   | E-Stop  | ``x.......`` | 0: Normal, 1: Emergency Stopped   |
   +---------+--------------+-----------------------------------+
   | Enabled | ``.....x..`` | 0: Disabled, 1: Enabled           |
   +---------+--------------+-----------------------------------+
   | Mode    | ``......xx`` | 0: TeloOp, 1: Test, 2: Autonomous |
   +---------+--------------+-----------------------------------+

.. _`alliance station`:

Alliance Station
^^^^^^^^^^^^^^^^

Computed by taking station [1, 3] and subtracting 1 for red, or adding 2 for blue.
Color is Red if ``value < 3``, else Blue. Position is ``value % 3 + 1``

.. _`tournament level`:

Tournament Level
^^^^^^^^^^^^^^^^

.. table::
   :widths: auto

   +---------------+-------+-------------------------------------------------+
   | Level         | Value | Comment                                         |
   +===============+=======+=================================================+
   | Match Test    | 0     | Only used during FMS setup for testing purposes |
   +---------------+-------+-------------------------------------------------+
   | Practice      | 1     |                                                 |
   +---------------+-------+-------------------------------------------------+
   | Qualification | 2     |                                                 |
   +---------------+-------+-------------------------------------------------+
   | Playoff       | 3     |                                                 |
   +---------------+-------+-------------------------------------------------+

.. _`fd date`:

Date
^^^^

.. table::
   :widths: auto

   +--------------+--------+--------+-------------------------+
   | Field        | Length | Type   | Comment                 |
   +==============+========+========+=========================+
   | Microseconds | 4      | uint32 |                         |
   +--------------+--------+--------+-------------------------+
   | Second       | 1      | uint8  |                         |
   +--------------+--------+--------+-------------------------+
   | Minute       | 1      | uint8  |                         |
   +--------------+--------+--------+-------------------------+
   | Hour         | 1      | uint8  | In UTC?                 |
   +--------------+--------+--------+-------------------------+
   | Day          | 1      | uint8  |                         |
   +--------------+--------+--------+-------------------------+
   | Month        | 1      | uint8  | 0 is January            |
   +--------------+--------+--------+-------------------------+
   | Year         | 1      | uint8  | Year (starting at 1900) |
   +--------------+--------+--------+-------------------------+

TCP
---

``10.0.100.5``, listening on TCP port 1750.

.. table::
   :widths: auto

   +-------+--------+--------+------------------------------------+
   | Field | Length | Type   | Comment                            |
   +=======+========+========+====================================+
   | Size  | 2      | uint16 | Including ID                       |
   +-------+--------+--------+------------------------------------+
   | ID    | 1      | uint8  | See table below (only of Size > 0) |
   +-------+--------+--------+------------------------------------+
   | Tags  | n      |        | Depends on tag type                |
   +-------+--------+--------+------------------------------------+

Tags
^^^^

.. table::
   :widths: auto

   +----------+------------------------------------------------+
   | ID       | Tag                                            |
   +==========+================================================+
   | ``0x00`` | :ref:`WPILib Version <fd version>`             |
   +----------+------------------------------------------------+
   | ``0x01`` | :ref:`RIO Version <fd version>`                |
   +----------+------------------------------------------------+
   | ``0x02`` | :ref:`DS Version <fd version>`                 |
   +----------+------------------------------------------------+
   | ``0x03`` | :ref:`PDP Version <fd version>`                |
   +----------+------------------------------------------------+
   | ``0x04`` | :ref:`PCM Version <fd version>`                |
   +----------+------------------------------------------------+
   | ``0x05`` | :ref:`CANJag Version <fd version>`             |
   +----------+------------------------------------------------+
   | ``0x06`` | :ref:`CANTalon Version <fd version>`           |
   +----------+------------------------------------------------+
   | ``0x07`` | :ref:`Third Party Device Version <fd version>` |
   +----------+------------------------------------------------+
   | ``0x14`` | `Event Code`_                                  |
   +----------+------------------------------------------------+
   | ``0x19`` | `Station Info`_                                |
   +----------+------------------------------------------------+
   | ``0x1a`` | `Challenge Question`_                          |
   +----------+------------------------------------------------+
   | ``0x1c`` | :ref:`Game Data <fd game data>`                |
   +----------+------------------------------------------------+

Versions all take the same format

.. _`fd version`:

Version
"""""""

See above table for devices and their associated tag IDs. Seems only the "preferred" DS version is sent to the Driver Station.

.. table::
   :widths: auto

   +---------+--------+--------+-------------------------------------+
   | Field   | Length | Type   | Comment                             |
   +=========+========+========+=====================================+
   | Status  | n      | string | `<bad>`, `<good>`, or `<preferred>` |
   +---------+--------+--------+-------------------------------------+
   | Version | n      | string |                                     |
   +---------+--------+--------+-------------------------------------+

.. _`event code`:

Event Code (``0x14``)
"""""""""""""""""""""

.. table::
   :widths: auto

   +------------+--------+--------+------------+
   | Field      | Length | Type   | Comment    |
   +============+========+========+============+
   | Event Code | 1 + n  | string | Event name |
   +------------+--------+--------+------------+

.. _`station info`:

Station Info (``0x19``)
"""""""""""""""""""""""

.. table::
   :widths: auto

   +------------------+--------+---------------------+---------+
   | Field            | Length | Type                | Comment |
   +------------------+--------+---------------------+---------+
   | Alliance Station | 1      | `Alliance Station`_ |         |
   +------------------+--------+---------------------+---------+
   | Station Status   | 1      | `Station Status`_   |         |
   +------------------+--------+---------------------+---------+

.. _`station status`:

Station Status
..............

.. table::
   :widths: auto

   +-----+---------+-----------------------------------------------+
   | Num | Status  | Comment                                       |
   +=====+=========+===============================================+
   | 0   | Good    | Sent if FMS Driver Station context is valid   |
   +-----+---------+-----------------------------------------------+
   | 1   | Bad     | Never sent?                                   |
   +-----+---------+-----------------------------------------------+
   | 2   | Waiting | Sent if FMS Driver Station context is invalid |
   +-----+---------+-----------------------------------------------+


.. _`challenge question`:

Challenge Question (``0x1a``)
"""""""""""""""""""""""""""""

.. table::
   :widths: auto

   +--------------+--------+--------+---------------------------------------------------------------------------+
   | Field        | Length | Type   | Comment                                                                   |
   +==============+========+========+===========================================================================+
   | Question     | 1 + n  | string | `Coolest robot EVER!!??`                                                  |
   +--------------+--------+--------+---------------------------------------------------------------------------+
   | Random Value | 2      | uint16 | Random number [1000, 2000] associated with the FMS Driver Station context |
   +--------------+--------+--------+---------------------------------------------------------------------------+

Offseason FMS allows for sending multiple questions, but the responses are only checked against the first one (as of 2018).

See the :ref:`Challenge Response <challenge response>` for possible responses.

.. _`fd game data`:

Game Data (``0x1c``)
""""""""""""""""""""

.. table::
   :widths: auto

   +-------+--------+--------+---------+
   | Field | Length | Type   | Comment |
   +=======+========+========+=========+
   | Data  | 1 + n  | string |         |
   +-------+--------+--------+---------+
